# Global configuration file for all charts

# ---------------------------------------------------------
# 1. Producer Configuration
# ---------------------------------------------------------
producer:
  service:
    type: NodePort
    port: 8080
    nodePort: 30080
  replicaCount: 1
  image:
    tag: latest

# ---------------------------------------------------------
# 2. Consumer Configuration
# ---------------------------------------------------------
consumer:
  service:
    type: NodePort
    port: 8081 # Unique port for consumer application
    nodePort: 30081 # Unique NodePort for external access
  replicaCount: 1
  image:
    tag: latest

# ---------------------------------------------------------
# 3. MariaDB Configuration
# ---------------------------------------------------------
mariadb:
  auth:
    rootPassword: "root"
    database: "story"
    username: "storyuser"
    password: "storypass"
  architecture: standalone
  primary:
    persistence:
      enabled: true
      storageClass: nfs-client
      size: 8Gi

# ---------------------------------------------------------
# 4. Kafka Configuration (Bitnami)
# ---------------------------------------------------------
kafka:
  # Using explicit image to avoid 'latest' issues
  image:
    repository: bitnamilegacy/kafka
    tag: 4.0.0-debian-12-r10
  # Authentication disabled for local development
  listeners:
    client:
      protocol: PLAINTEXT
    controller:
      protocol: PLAINTEXT
    interbroker:
      protocol: PLAINTEXT
  controller:
    replicaCount: 1
    persistence:
      enabled: true
      storageClass: nfs-client
      size: 10Gi
  service:
    type: ClusterIP
    port: 9092

# ---------------------------------------------------------
# 5. Monitoring Configuration
# ---------------------------------------------------------
monitoring:
  grafana:
    service:
      type: NodePort
      nodePort: 32000
    adminPassword: "tQOTxKCkJEVONGesmVtw263SVdqxd8jTfvfFscCP"
    persistence:
      enabled: true
      storageClassName: nfs-client
      size: 5Gi
  prometheus:
    service:
      type: NodePort
      nodePort: 32001
    prometheusSpec:
      storageSpec:
        volumeClaimTemplate:
          spec:
            storageClassName: nfs-client
            accessModes: ["ReadWriteOnce"]
            resources:
              requests:
                storage: 20Gi

      # Scrape configurations for both producer and consumer apps
      additionalScrapeConfigs:
        - job_name: 'producer'
          metrics_path: /actuator/prometheus
          scrape_interval: 15s
          kubernetes_sd_configs:
            - role: endpoints
          relabel_configs:
            - source_labels: [__meta_kubernetes_service_name]
              action: keep
              regex: producer
            - source_labels: [__meta_kubernetes_namespace]
              action: keep
              regex: default
            - source_labels: [__meta_kubernetes_endpoint_port_name]
              action: keep
              regex: http
        - job_name: 'consumer'
          metrics_path: /actuator/prometheus
          scrape_interval: 15s
          kubernetes_sd_configs:
            - role: endpoints
          relabel_configs:
            - source_labels: [__meta_kubernetes_service_name]
              action: keep
              regex: consumer
            - source_labels: [__meta_kubernetes_namespace]
              action: keep
              regex: default
            - source_labels: [__meta_kubernetes_endpoint_port_name]
              action: keep
              regex: http