# Global configuration file for all charts

# 1. Backend Configuration
backend:
  service:
    type: NodePort
    port: 8080
    nodePort: 30080
  replicaCount: 1
  image:
    tag: latest

# 2. MariaDB Configuration
mariadb:
  auth:
    rootPassword: "root"
    database: "story"
    username: "storyuser"
    password: "storypass"
  architecture: standalone
  primary:
    persistence:
      enabled: true
      storageClass: nfs-client
      size: 8Gi

# 3. Kafka Configuration (Bitnami)
kafka:
  # Added a fixed clusterId to bypass the "PASSWORDS ERROR"
  kraft:
    clusterId: "abcdefghijklmnopqrstuv" # Must be 22 characters base64url encoded

  # Even if auth is disabled, Bitnami checks for these keys
  sasl:
    interbroker:
      password: "inter_broker_password_123"
    controller:
      password: "controller_password_123"

  auth:
    clientProtocol: plaintext
    interBrokerProtocol: plaintext
    controllerProtocol: plaintext

  listeners:
    client:
      protocol: PLAINTEXT
    controller:
      protocol: PLAINTEXT
    interbroker:
      protocol: PLAINTEXT

  controller:
    replicaCount: 1
    persistence:
      enabled: true
      storageClass: nfs-client
      size: 10Gi

  service:
    type: ClusterIP
    port: 9092

# 4. Monitoring Configuration
monitoring:
  grafana:
    service:
      type: NodePort
      nodePort: 32000
    adminPassword: "tQOTxKCkJEVONGesmVtw263SVdqxd8jTfvfFscCP"
    persistence:
      enabled: true
      storageClassName: nfs-client
      size: 5Gi
  prometheus:
    service:
      type: NodePort
      nodePort: 32001
    prometheusSpec:
      storageSpec:
        volumeClaimTemplate:
          spec:
            storageClassName: nfs-client
            accessModes: ["ReadWriteOnce"]
            resources:
              requests:
                storage: 20Gi
      additionalScrapeConfigs:
        - job_name: 'backend'
          metrics_path: /actuator/prometheus
          scrape_interval: 15s
          kubernetes_sd_configs:
            - role: endpoints
          relabel_configs:
            - source_labels: [__meta_kubernetes_service_name]
              action: keep
              regex: backend
            - source_labels: [__meta_kubernetes_namespace]
              action: keep
              regex: default
            - source_labels: [__meta_kubernetes_endpoint_port_name]
              action: keep
              regex: http